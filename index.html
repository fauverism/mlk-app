<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bridges â€“ Finding Unity in Difference</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital@0;1&family=Prata&family=Lora:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --sepia-darkest: #5c4a42;
            --sepia-dark: #8b7355;
            --sepia-medium: #a89968;
            --sepia-light: #d4c4a8;
            --sepia-pale: #e8dcc8;
            --sepia-cream: #f5f1ed;
            --gold: #d4af37;
            --accent: #c4744a;
            
            --font-display: 'Prata', serif;
            --font-serif: 'Crimson Text', serif;
            --font-body: 'Lora', serif;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background: linear-gradient(135deg, var(--sepia-cream) 0%, #f9f5f0 100%);
            color: var(--sepia-darkest);
            font-family: var(--font-body);
            line-height: 1.8;
            font-size: 18px;
            min-height: 100vh;
        }

        /* Grain texture overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.02;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' seed='2'/%3E%3C/filter%3E%3Crect width='400' height='400' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 40px;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 120px;
            animation: fadeInDown 0.8s ease-out;
        }

        .mlk-image-container {
            margin-bottom: 50px;
            display: flex;
            justify-content: center;
        }

        .mlk-image {
            max-width: 280px;
            height: auto;
            border-radius: 2px;
            filter: sepia(0.6) brightness(1.05);
            box-shadow: 0 10px 40px rgba(92, 74, 66, 0.25);
            animation: fadeInDown 1s ease-out;
        }

        header h1 {
            font-family: var(--font-display);
            font-size: 72px;
            letter-spacing: 2px;
            margin-bottom: 20px;
            color: var(--sepia-dark);
            font-weight: normal;
        }

        header .tagline {
            font-family: var(--font-serif);
            font-size: 28px;
            font-style: italic;
            color: var(--sepia-medium);
            margin-bottom: 40px;
            letter-spacing: 1px;
        }

        header .date {
            font-size: 16px;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--sepia-dark);
            opacity: 0.7;
        }

        .mlk-quote {
            margin-top: 40px;
            padding: 20px;
            background: rgba(212, 196, 168, 0.15);
            border-left: 5px solid var(--gold);
            font-family: var(--font-serif);
            font-size: 20px;
            font-style: italic;
            color: var(--sepia-dark);
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            animation: fadeInUp 0.8s ease-out 0.2s backwards;
            transition: opacity 0.4s ease-in-out;
            opacity: 1;
        }

        .mlk-quote::before {
            content: '"';
            font-size: 60px;
            color: var(--gold);
            display: block;
            line-height: 0;
            margin-bottom: 10px;
        }

        .mlk-quote .attribution {
            margin-top: 20px;
            font-size: 16px;
            font-style: normal;
            color: var(--sepia-medium);
        }

        /* Main content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 60px;
            margin-bottom: 100px;
        }

        /* Input Section */
        .input-section {
            display: flex;
            flex-direction: column;
            gap: 40px;
        }

        .perspectives-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .button-row {
            display: flex;
            justify-content: flex-start;
        }

        .perspective-input {
            animation: fadeInUp 0.8s ease-out 0.4s backwards;
        }

        .perspective-input label {
            display: block;
            font-family: var(--font-display);
            font-size: 24px;
            color: var(--sepia-dark);
            margin-bottom: 16px;
            letter-spacing: 1px;
        }

        .perspective-input textarea {
            width: 100%;
            min-height: 120px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid var(--sepia-light);
            border-radius: 2px;
            font-family: var(--font-body);
            font-size: 16px;
            color: var(--sepia-darkest);
            resize: vertical;
            transition: all 0.3s ease;
        }

        .perspective-input textarea:focus {
            outline: none;
            border-color: var(--gold);
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.1);
        }

        .perspective-input textarea::placeholder {
            color: var(--sepia-medium);
            opacity: 0.6;
        }

        .char-counter {
            text-align: right;
            font-size: 14px;
            color: var(--sepia-medium);
            margin-top: 8px;
            opacity: 0.7;
            transition: color 0.3s ease;
        }

        .char-counter.warning {
            color: var(--accent);
        }

        .examples-section {
            margin-top: 24px;
            padding: 20px;
            background: rgba(212, 175, 55, 0.05);
            border-radius: 2px;
            border: 1px dashed var(--sepia-light);
        }

        .examples-title {
            font-family: var(--font-display);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--sepia-medium);
            margin-bottom: 12px;
        }

        .example-link {
            display: inline-block;
            margin: 4px 8px 4px 0;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid var(--sepia-light);
            border-radius: 2px;
            font-size: 13px;
            color: var(--sepia-dark);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .example-link:hover {
            background: var(--sepia-cream);
            border-color: var(--gold);
            transform: translateY(-1px);
        }

        /* Button */
        .explore-button {
            align-self: flex-start;
            padding: 16px 48px;
            margin-top: 40px;
            background: var(--sepia-dark);
            color: var(--sepia-cream);
            border: none;
            font-family: var(--font-display);
            font-size: 18px;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            text-transform: uppercase;
            border-radius: 1px;
            box-shadow: 0 4px 15px rgba(92, 74, 66, 0.2);
        }

        .explore-button:hover {
            background: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(196, 116, 74, 0.3);
        }

        .explore-button:active {
            transform: translateY(0);
        }

        .explore-button.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* Results Section */
        .results-section {
            animation: fadeInUp 0.8s ease-out 0.6s backwards;
            min-height: 0;
            overflow: hidden;
        }

        .results-section .results-title {
            display: none;
        }

        .results-section.active .results-title {
            display: block;
        }

        .results-title {
            font-family: var(--font-display);
            font-size: 28px;
            color: var(--sepia-dark);
            margin-bottom: 40px;
            letter-spacing: 1px;
        }

        .bridge-container {
            display: none;
            opacity: 0;
        }

        .bridge-container.active {
            display: contents;
            animation: fadeInUp 0.8s ease-out;
        }

        .bridge-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(232, 220, 200, 0.3) 100%);
            padding: 30px;
            margin-bottom: 24px;
            border-radius: 2px;
            border-left: 4px solid var(--gold);
            backdrop-filter: blur(5px);
            animation: slideInUp 0.6s ease-out;
            animation-fill-mode: backwards;
        }

        .bridge-item:nth-child(1) { animation-delay: 0.1s; }
        .bridge-item:nth-child(2) { animation-delay: 0.2s; }
        .bridge-item:nth-child(3) { animation-delay: 0.3s; }
        .bridge-item:nth-child(4) { animation-delay: 0.4s; }

        .bridge-label {
            font-family: var(--font-display);
            font-size: 16px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--sepia-medium);
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .bridge-text {
            font-size: 17px;
            line-height: 1.7;
            color: var(--sepia-dark);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--sepia-light);
        }

        .action-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--sepia-light);
            color: var(--sepia-dark);
            font-size: 13px;
            font-family: var(--font-body);
            cursor: pointer;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: var(--sepia-cream);
            border-color: var(--gold);
        }

        .action-btn svg {
            width: 14px;
            height: 14px;
            margin-right: 6px;
            vertical-align: middle;
        }

        .tooltip {
            position: fixed;
            background: var(--sepia-darkest);
            color: var(--sepia-cream);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 13px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .tooltip.active {
            opacity: 1;
        }

        .usage-banner {
            margin-bottom: 40px;
            padding: 20px 24px;
            background: rgba(212, 175, 55, 0.08);
            border-radius: 2px;
            border-left: 4px solid var(--gold);
            text-align: center;
            font-family: var(--font-body);
            font-size: 15px;
            color: var(--sepia-dark);
        }

        .usage-banner strong {
            color: var(--sepia-darkest);
            font-weight: 600;
        }

        .usage-banner.warning {
            background: rgba(196, 116, 74, 0.08);
            border-left-color: var(--accent);
        }

        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(92, 74, 66, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .login-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        .login-modal-content {
            background: var(--sepia-cream);
            padding: 50px;
            border-radius: 2px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            animation: slideInUp 0.4s ease-out;
        }

        .login-modal-content h2 {
            font-family: var(--font-display);
            font-size: 32px;
            color: var(--sepia-dark);
            margin-bottom: 20px;
        }

        .login-modal-content p {
            font-size: 16px;
            color: var(--sepia-medium);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .login-modal-content .reset-info {
            font-size: 14px;
            color: var(--accent);
            margin-bottom: 30px;
            font-style: italic;
        }

        .login-button {
            padding: 14px 40px;
            background: var(--sepia-dark);
            color: var(--sepia-cream);
            border: none;
            font-family: var(--font-display);
            font-size: 16px;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            border-radius: 1px;
            margin-right: 10px;
        }

        .login-button:hover {
            background: var(--accent);
            transform: translateY(-2px);
        }

        .login-button.secondary {
            background: transparent;
            border: 2px solid var(--sepia-light);
            color: var(--sepia-dark);
        }

        .login-button.secondary:hover {
            background: var(--sepia-cream);
            border-color: var(--gold);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .loading-indicator {
            display: none;
            text-align: center;
            padding: 40px 0;
        }

        .loading-indicator.active {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--sepia-light);
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--sepia-medium);
            font-style: italic;
        }

        /* Historical Context Cards */
        .context-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 120px;
            padding-top: 80px;
            border-top: 2px solid var(--sepia-light);
        }

        .context-card {
            padding: 40px;
            background: linear-gradient(135deg, rgba(139, 115, 85, 0.08) 0%, rgba(212, 196, 168, 0.05) 100%);
            border-radius: 2px;
            animation: fadeInUp 0.8s ease-out 0.6s backwards;
        }

        .context-card h3 {
            font-family: var(--font-display);
            font-size: 22px;
            color: var(--sepia-dark);
            margin-bottom: 16px;
            letter-spacing: 1px;
        }

        .context-card p {
            font-size: 16px;
            color: var(--sepia-medium);
            line-height: 1.8;
        }

        .context-quote {
            font-family: var(--font-serif);
            font-style: italic;
            color: var(--accent);
            margin-top: 16px;
            padding-left: 16px;
            border-left: 3px solid var(--gold);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .perspectives-row {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 48px;
            }

            header .tagline {
                font-size: 22px;
            }

            .mlk-image {
                max-width: 200px;
            }

            .context-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 40px 20px;
            }
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .error-message {
            display: none;
            padding: 20px;
            background: rgba(196, 116, 74, 0.1);
            border-left: 4px solid var(--accent);
            color: var(--accent);
            margin-bottom: 20px;
            border-radius: 2px;
        }

        .error-message.active {
            display: block;
            animation: fadeInUp 0.6s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="mlk-image-container">
                <img src="Yousuf-Karsh-Martin-Luther-King-1962-1574x1960.jpg" alt="Martin Luther King Jr." class="mlk-image">
            </div>

            <h1>Bridges</h1>
            <p class="tagline">Finding Unity in Difference</p>
            
            <div class="mlk-quote" id="rotatingQuote">
                <p id="quoteText">I have a dream that one day this nation will rise up and live out the true meaning of its creed: "We hold these truths to be self-evident, that all men are created equal."</p>
                <div class="attribution" id="quoteAttribution">â€” Martin Luther King Jr., August 28, 1963</div>
            </div>
        </header>

        <div class="main-content">
            <div class="input-section">
                <div class="usage-banner" id="usageBanner">
                    <strong id="usageCount">10</strong> free explorations remaining today
                </div>

                <div class="perspectives-row">
                    <div class="perspective-input">
                        <label>First Perspective</label>
                        <textarea id="perspective1" placeholder="E.g., 'Environmental advocates who prioritize climate action and see fossil fuels as a threat.' Describe their core values, concerns, and what they're trying to protect." maxlength="500"></textarea>
                        <div class="char-counter" id="counter1">0 / 500</div>
                    </div>

                    <div class="perspective-input">
                        <label>Second Perspective</label>
                        <textarea id="perspective2" placeholder="E.g., 'Workers in fossil fuel industries who value job security and economic stability for their families.' Describe what matters to them and why." maxlength="500"></textarea>
                        <div class="char-counter" id="counter2">0 / 500</div>
                    </div>
                </div>

                <div class="examples-section">
                    <div class="examples-title">Try an Example</div>
                    <button class="example-link" data-example="climate">Climate vs Jobs</button>
                    <button class="example-link" data-example="privacy">Privacy vs Security</button>
                    <button class="example-link" data-example="urban">Urban vs Rural</button>
                    <button class="example-link" data-example="tech">Tech Innovation vs Regulation</button>
                </div>

                <div class="button-row">
                    <button class="explore-button" id="exploreBtn">Explore Bridges</button>
                </div>
            </div>

            <div class="results-section">
                <h2 class="results-title">Bridges of Unity</h2>
                
                <div class="error-message" id="errorMessage"></div>

                <div class="loading-indicator" id="loadingIndicator">
                    <div class="spinner"></div>
                    <p class="loading-text">Finding common ground...</p>
                </div>

                <div class="bridge-container" id="bridgeContainer"></div>
            </div>
        </div>

        <div class="context-grid">
            <div class="context-card">
                <h3>The Power of Unity</h3>
                <p>MLK understood that lasting change comes not from division, but from recognizing our shared humanity. True strength emerges when we seek to understand perspectives different from our own.</p>
                <p class="context-quote">"We must learn to live together as brothers or perish together as fools."</p>
            </div>

            <div class="context-card">
                <h3>Why This Matters</h3>
                <p>In our divided times, we need tools that help us bridge understanding. AI can help us see past positions to the values beneathâ€”the concerns, hopes, and principles that unite us despite surface disagreements.</p>
                <p class="context-quote">"Nonviolence is a powerful and just weapon, which cuts without wounding and ennobles the man who wields it."</p>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <div class="login-modal" id="loginModal">
        <div class="login-modal-content">
            <h2>Daily Limit Reached</h2>
            <p>You've used all 10 free explorations for today. To continue discovering bridges and finding common ground, please log in or create a free account.</p>
            <p class="reset-info">Your free uses will reset in <strong id="resetTime">--</strong> hours.</p>
            <button class="login-button" onclick="handleLogin()">Login / Sign Up</button>
            <button class="login-button secondary" onclick="closeLoginModal()">Close</button>
        </div>
    </div>

    <script>
        // Example perspectives data
        const examples = {
            climate: {
                perspective1: "Environmental advocates who prioritize climate action, see fossil fuels as an existential threat, and believe urgent transformation is needed to prevent catastrophic warming and protect future generations.",
                perspective2: "Workers in coal mining and fossil fuel industries who value job security, economic stability for their families, and feel their livelihoods and community identities are under threat from rapid energy transitions."
            },
            privacy: {
                perspective1: "Privacy advocates who believe personal data should be protected, encryption should be strong, and government surveillance should be limited to preserve civil liberties and individual freedom.",
                perspective2: "National security officials who need access to communications data to prevent terrorism, investigate crimes, and protect public safety, viewing some privacy restrictions as necessary for security."
            },
            urban: {
                perspective1: "Urban residents who value diversity, public transit, cultural amenities, and progressive policies, seeing cities as centers of innovation and social progress.",
                perspective2: "Rural communities who value self-sufficiency, traditional lifestyles, land stewardship, and local autonomy, feeling overlooked by urban-centric policies and cultural narratives."
            },
            tech: {
                perspective1: "Tech innovators who believe rapid development and minimal regulation foster breakthroughs, create jobs, and solve problems through market-driven solutions and technological advancement.",
                perspective2: "Consumer advocates and ethicists who see need for oversight to prevent harm, protect privacy, ensure fairness, and align technology development with human values and social good."
            }
        };

        // MLK Quote collection
        const mlkQuotes = [
            {
                text: "I have a dream that one day this nation will rise up and live out the true meaning of its creed: \"We hold these truths to be self-evident, that all men are created equal.\"",
                attribution: "â€” Martin Luther King Jr., August 28, 1963",
                readingTime: 25
            },
            {
                text: "Nonviolence is a powerful and just weapon, which cuts without wounding and ennobles the man who wields it. It is a sword that heals.",
                attribution: "â€” Martin Luther King Jr.",
                readingTime: 20
            },
            {
                text: "We must learn to live together as brothers or perish together as fools.",
                attribution: "â€” Martin Luther King Jr.",
                readingTime: 12
            },
            {
                text: "Darkness cannot drive out darkness; only light can do that. Hate cannot drive out hate; only love can do that.",
                attribution: "â€” Martin Luther King Jr.",
                readingTime: 18
            },
            {
                text: "The arc of the moral universe is long, but it bends toward justice.",
                attribution: "â€” Martin Luther King Jr.",
                readingTime: 13
            },
            {
                text: "Injustice anywhere is a threat to justice everywhere. We are caught in an inescapable network of mutuality, tied in a single garment of destiny.",
                attribution: "â€” Martin Luther King Jr.",
                readingTime: 22
            },
            {
                text: "I have decided to stick with love. Hate is too great a burden to bear.",
                attribution: "â€” Martin Luther King Jr.",
                readingTime: 14
            },
            {
                text: "The question is not whether we will be extremists, but what kind of extremists we will be.",
                attribution: "â€” Martin Luther King Jr.",
                readingTime: 16
            },
            {
                text: "True peace is not merely the absence of tension: it is the presence of justice.",
                attribution: "â€” Martin Luther King Jr.",
                readingTime: 15
            },
            {
                text: "I am convinced that love is the most durable power in the world. It is not an expression of impractical idealism, but a practical realism.",
                attribution: "â€” Martin Luther King Jr.",
                readingTime: 21
            }
        ];

        let currentQuoteIndex = 0;
        let readingTimeAccumulated = 0;
        let isReadingMode = false;
        let readingTimer = null;

        function initializeQuoteRotation() {
            const quoteElement = document.getElementById('rotatingQuote');
            
            // Start reading mode when user scrolls to the quote
            quoteElement.addEventListener('mouseenter', startReadingMode);
            quoteElement.addEventListener('mouseleave', endReadingMode);
            
            // Also detect scroll into view
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        startReadingMode();
                    }
                });
            }, { threshold: 0.5 });
            
            observer.observe(quoteElement);

            // Keyboard focus
            document.addEventListener('focus', () => {
                if (document.activeElement === perspective1 || document.activeElement === perspective2) {
                    startReadingMode();
                }
            }, true);

            displayQuote(0);
        }

        function startReadingMode() {
            if (isReadingMode) return;
            isReadingMode = true;
            readingTimeAccumulated = 0;
            
            readingTimer = setInterval(() => {
                readingTimeAccumulated += 0.5; // Increment by 0.5 second
                
                // Calculate which quote to show based on accumulated reading time
                let totalTime = 0;
                for (let i = 0; i < mlkQuotes.length; i++) {
                    totalTime += mlkQuotes[i].readingTime;
                    if (readingTimeAccumulated < totalTime) {
                        if (currentQuoteIndex !== i) {
                            currentQuoteIndex = i;
                            displayQuote(i);
                        }
                        break;
                    }
                }
            }, 500);
        }

        function endReadingMode() {
            isReadingMode = false;
            if (readingTimer) {
                clearInterval(readingTimer);
            }
        }

        function displayQuote(index) {
            const quote = mlkQuotes[index % mlkQuotes.length];
            const quoteText = document.getElementById('quoteText');
            const quoteAttribution = document.getElementById('quoteAttribution');
            const quoteContainer = document.getElementById('rotatingQuote');
            
            // Fade out
            quoteContainer.style.opacity = '0.7';
            
            setTimeout(() => {
                quoteText.textContent = quote.text;
                quoteAttribution.textContent = quote.attribution;
                quoteContainer.style.opacity = '1';
            }, 200);
        }

        // DOM Elements
        const exploreBtn = document.getElementById('exploreBtn');
        const perspective1 = document.getElementById('perspective1');
        const perspective2 = document.getElementById('perspective2');
        const bridgeContainer = document.getElementById('bridgeContainer');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');
        const counter1 = document.getElementById('counter1');
        const counter2 = document.getElementById('counter2');
        const tooltip = document.getElementById('tooltip');
        const usageBanner = document.getElementById('usageBanner');
        const usageCount = document.getElementById('usageCount');
        const loginModal = document.getElementById('loginModal');

        // Client ID for rate limiting
        let clientId = localStorage.getItem('bridges_client_id');
        if (!clientId) {
            clientId = generateClientId();
            localStorage.setItem('bridges_client_id', clientId);
        }

        // Generate unique client ID
        function generateClientId() {
            return 'client_' + Math.random().toString(36).substring(2) + Date.now().toString(36);
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            initializeQuoteRotation();
            loadSavedData();
            setupEventListeners();
            updateUsageDisplay();
        });

        // Setup all event listeners
        function setupEventListeners() {
            exploreBtn.addEventListener('click', exploreBridges);

            // Character counters
            perspective1.addEventListener('input', () => updateCharCounter(perspective1, counter1));
            perspective2.addEventListener('input', () => updateCharCounter(perspective2, counter2));

            // Auto-save
            perspective1.addEventListener('input', debounce(saveData, 500));
            perspective2.addEventListener('input', debounce(saveData, 500));

            // Example buttons
            document.querySelectorAll('.example-link').forEach(btn => {
                btn.addEventListener('click', () => loadExample(btn.dataset.example));
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);

            // Initialize counters
            updateCharCounter(perspective1, counter1);
            updateCharCounter(perspective2, counter2);
        }

        // Update usage display
        async function updateUsageDisplay() {
            try {
                const response = await fetch('/api/usage', {
                    method: 'POST',
                    headers: {
                        'x-client-id': clientId,
                        'content-type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const remaining = data.uses_remaining;
                    
                    usageCount.textContent = remaining;
                    
                    if (remaining <= 3) {
                        usageBanner.classList.add('warning');
                    } else {
                        usageBanner.classList.remove('warning');
                    }

                    if (remaining === 0) {
                        usageBanner.innerHTML = `<strong>Daily limit reached.</strong> Your free uses will reset in ${data.reset_time_hours} hours.`;
                    }
                }
            } catch (error) {
                console.error('Error checking usage:', error);
            }
        }

        // Login modal functions
        function handleLogin() {
            // For now, just show an alert. You can integrate actual auth later.
            alert('Login functionality coming soon! For now, your free uses will reset in 24 hours from your first use.');
            closeLoginModal();
        }

        function closeLoginModal() {
            loginModal.classList.remove('active');
        }

        // Character counter
        function updateCharCounter(textarea, counter) {
            const count = textarea.value.length;
            const max = textarea.maxLength;
            counter.textContent = `${count} / ${max}`;

            if (count > max * 0.9) {
                counter.classList.add('warning');
            } else {
                counter.classList.remove('warning');
            }
        }

        // Load example perspectives
        function loadExample(exampleKey) {
            const example = examples[exampleKey];
            if (example) {
                perspective1.value = example.perspective1;
                perspective2.value = example.perspective2;
                updateCharCounter(perspective1, counter1);
                updateCharCounter(perspective2, counter2);
                saveData();

                // Smooth scroll to button
                exploreBtn.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('bridgesData', JSON.stringify({
                perspective1: perspective1.value,
                perspective2: perspective2.value,
                timestamp: Date.now()
            }));
        }

        // Load saved data from localStorage
        function loadSavedData() {
            const saved = localStorage.getItem('bridgesData');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    perspective1.value = data.perspective1 || '';
                    perspective2.value = data.perspective2 || '';
                    updateCharCounter(perspective1, counter1);
                    updateCharCounter(perspective2, counter2);
                } catch (e) {
                    console.error('Error loading saved data:', e);
                }
            }
        }

        // Debounce helper
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Keyboard shortcuts
        function handleKeyboardShortcuts(e) {
            // Ctrl/Cmd + Enter to explore
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                exploreBridges();
            }

            // Escape to clear error
            if (e.key === 'Escape') {
                errorMessage.classList.remove('active');
            }
        }

        async function exploreBridges() {
            const view1 = perspective1.value.trim();
            const view2 = perspective2.value.trim();

            if (!view1 || !view2) {
                showError('Please enter both perspectives to explore bridges.');
                return;
            }

            exploreBtn.classList.add('loading');
            exploreBtn.disabled = true;
            loadingIndicator.classList.add('active');
            bridgeContainer.classList.remove('active');
            errorMessage.classList.remove('active');
            document.querySelector('.results-section').classList.remove('active');

            const prompt = `You are helping people find unity and common ground rooted in Martin Luther King Jr.'s vision of shared humanity and dignity.

Two perspectives are in apparent tension:

PERSPECTIVE 1: ${view1}

PERSPECTIVE 2: ${view2}

Analyze these perspectives deeply and provide 3-4 specific "bridges" that connect themâ€”shared values, common concerns, or underlying principles that unite them despite surface disagreement. Each bridge should show how both perspectives actually care about similar things or are trying to achieve compatible goals.

Format your response as:
BRIDGE 1: [A shared principle or value]
[Explanation of how both perspectives align here]

BRIDGE 2: [Another shared element]
[Explanation]

Continue for 3-4 bridges total. Root your response in MLK's principles: the dignity of all people, justice, beloved community, the power of nonviolence, and our interconnectedness.`;

            try {
                const response = await fetch('/api/messages', {
                    method: 'POST',
                    headers: {
                        'x-client-id': clientId,
                        'content-type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 1024,
                        messages: [
                            {
                                role: 'user',
                                content: prompt
                            }
                        ]
                    })
                });

                if (response.status === 429) {
                    // Rate limit exceeded
                    const errorData = await response.json();
                    const resetTime = errorData.error.remaining_time_hours || 24;
                    document.getElementById('resetTime').textContent = resetTime;
                    loginModal.classList.add('active');
                    return;
                }

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                }

                const data = await response.json();
                const content = data.content[0].text;

                // Update usage display
                const usesRemaining = response.headers.get('X-Uses-Remaining');
                if (usesRemaining !== null) {
                    usageCount.textContent = usesRemaining;
                    if (parseInt(usesRemaining) <= 3) {
                        usageBanner.classList.add('warning');
                    }
                }

                displayBridges(content);
                
                // Update usage display after successful request
                setTimeout(updateUsageDisplay, 500);
            } catch (error) {
                showError(`Error: ${error.message}`);
                console.error('API Error:', error);
            } finally {
                exploreBtn.classList.remove('loading');
                exploreBtn.disabled = false;
                loadingIndicator.classList.remove('active');
            }
        }

        function displayBridges(content) {
            bridgeContainer.innerHTML = '';
            const resultsSection = document.querySelector('.results-section');
            resultsSection.classList.add('active');

            // Parse bridges from the response
            const bridgeMatches = content.split(/BRIDGE \d+:/i).slice(1);

            bridgeMatches.forEach((match, index) => {
                const lines = match.trim().split('\n');
                const label = lines[0];
                const text = lines.slice(1).join(' ').trim();

                if (label || text) {
                    const bridgeItem = document.createElement('div');
                    bridgeItem.className = 'bridge-item';
                    bridgeItem.innerHTML = `
                        <div class="bridge-label">Connection ${index + 1}: ${label}</div>
                        <div class="bridge-text">${text}</div>
                        <div class="action-buttons">
                            <button class="action-btn copy-btn" data-text="${escapeHtml(label + '\n\n' + text)}">
                                ðŸ“‹ Copy
                            </button>
                        </div>
                    `;
                    bridgeContainer.appendChild(bridgeItem);
                }
            });

            // Add event listeners for copy buttons
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', () => copyToClipboard(btn.dataset.text, btn));
            });

            bridgeContainer.classList.add('active');

            // Scroll to results
            setTimeout(() => {
                resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }

        // Copy to clipboard
        async function copyToClipboard(text, button) {
            try {
                await navigator.clipboard.writeText(text);
                showTooltip('Copied!', button);
            } catch (err) {
                showTooltip('Failed to copy', button);
                console.error('Copy failed:', err);
            }
        }

        // Show tooltip
        function showTooltip(message, element) {
            const rect = element.getBoundingClientRect();
            tooltip.textContent = message;
            tooltip.style.left = rect.left + rect.width / 2 + 'px';
            tooltip.style.top = rect.top - 40 + 'px';
            tooltip.style.transform = 'translateX(-50%)';
            tooltip.classList.add('active');

            setTimeout(() => {
                tooltip.classList.remove('active');
            }, 2000);
        }

        // HTML escape helper
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showError(msg) {
            errorMessage.textContent = msg;
            errorMessage.classList.add('active');
            errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });

            setTimeout(() => {
                errorMessage.classList.remove('active');
            }, 8000);
        }
    </script>
</body>
</html>
